### 什么是闭包
- **闭包**是指有权访问另一个函数作用域中的变量的函数。
- 闭包就是能够读取其他函数内部变量的函数。
本质上，闭包就是将函数内部和函数外部连接起来的一座桥梁。 —— 阮一峰
- 对于闭包返回的函数没有立即执行，而是调用的时候才执行。

#### 从一个例子说起
就直接引用红宝书7.2.1的一个例子吧：
```
function createFunctions() { 
    var result = new Array()
    for (var i = 0; i < 10; i++) { 
        result[i] = function() { 
            return i
        }
    } 
    return result
}

var func = createFunctions()

func[0]()
func[5]()
```
预期结果`0`、`5`； 实际结果`10`、`10`
> 返回闭包时牢记的一点就是：返回函数不要引用任何循环变量，或者后续会发生变化的变量。 —— 廖雪峰

如果非要引用循环变量，怎么把上面的例子进行改良呢？

1. 方法一：创建另一个匿名函数（闭包）
```
function createFunctions() { 
    var result = new Array()
    for (var i = 0; i < 10; i++) { 
        let j = i
        result[i] = (function(num) { 
            return function () {
                return num
            }
        })(i)
    } 
    return result
}

var func = createFunctions()

func[0]()
func[5]()
```

2. 方法二：使用ES6语法，用`let`代替`var`
JS没有块级作用域的概念，但是到了ES6就有了
```
function createFunctions() { 
    var result = new Array()
    for (let i = 0; i < 10; i++) { 
        result[i] = function() { 
            return i
        }
    } 
    return result
}

var func = createFunctions()

func[0]()
func[5]()
```


### 闭包的作用
保护 + 保存

（私有变量）

### 闭包的使用场景



### 使用闭包要注意什么
内存泄漏问题
> 闭包会引用包含函数的整个活动对象
```
function assignHandler(){ 
 var element = document.getElementById("someElement"); 
 element.onclick = function(){ 
 alert(element.id); 
 }; 
}
```

```
function assignHandler(){ 
 var element = document.getElementById("someElement"); 
 var id = element.id; // 不足以
 element.onclick = function(){ 
 alert(id); 
 }; 
 element = null; // 必须加上这个
}
```
闭包会引用包含函数的整个活动对象，而其中包含着 element，因此仅仅将`element.id`保存到id是不足够的，即便它解决了循环引用的问题。还需要将 element 设置为 `null`。

### 几道面试题

 
https://www.liaoxuefeng.com/wiki/1022910821149312/1023021250770016

https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures

http://www.alloyteam.com/2019/07/closure/

https://zh.javascript.info/closure